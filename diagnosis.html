<html></html>
  <head>
    <meta charset="utf-8">
    <script src="assets/js/jquery-3.7.1.js"></script>
    <script src="assets/bootstrap/js/bootstrap.min.js"></script>
  </head>
  <body>
<div class="row" style="width:40%; margin-right: 10%;margin-left: 0px;">
  <div class="col">
    <span style="color:black; font-size: 20px; font-weight:bold; margin-left: -.75rem;"><p id="network_diagnostics">Диагностика сети</p></span>
    <br></br>

    <div style="display: flex; flex-direction: row; align-items: center; margin: 10px 0 10px 0;">
      <input type="radio" id="ping" name="action" value="ping" checked>
      <label for="ping" id="ping-text" style="padding: 0; margin: 0 0 0 10px;">Пинг</label>
    </div>
    <div style="display: flex; flex-direction: row; align-items: center; margin: 10px 0 10px 0;">
      <input type="radio" id="traceroute" name="action" value="traceroute">
      <label for="traceroute" id="tracing" style="padding: 0; margin: 0 0 0 10px;">Трассировка</label>
    </div>
    <div style="display: flex; flex-direction: row; align-items: center; margin: 10px 0 10px 0;">
      <input type="radio" id="speedtest" name="action" value="speedtest">
      <label for="speedtest" id="connection_speed" style="padding: 0; margin: 0 0 0 10px;">Скорость соединения</label>
    </div>
    <div style="display: flex; flex-direction: row; align-items: center; margin: 10px 0 10px 0;">
      <input type="radio" id="checksip" name="action" value="checksip">
      <label for="checksip" id="sip_check" style="padding: 0; margin: 0 0 0 10px;">Проверка SIP</label>
    </div>
    <div style="color: #6C6C6C; font-size: 18px; font-family: Gilroy; font-weight: 500; line-height: 30px; margin-left: -.75rem;"><p id="ip_address-title">IP-адрес (Cтатус соединения)</p></div> 
    <div class="row" style="height: 50px; background: white; border-radius: 10px; border: 1px #D9D9D9 solid; margin-bottom: 10px; align-items: center;">
      <input id="address" type="text" placeholder="Введите IP адрес" autocomplete="off" style="width: 100%; height: 100%; background: white; border-radius: 10px; border: none; padding-left: 10px; font-size: 18px; font-family: Gilroy; font-weight: 500;">
    </div>
    <div class="row" style="height: 50px; border: none; margin-bottom: 10px; align-items: center;">
      <button id="run-button" type="button" class="btn" style="width: 100%; height: 100%; color: white; background: #7BAF21;">Запустить</button>
    </div>
    <div style="color: #6C6C6C; font-size: 18px; font-family: Gilroy; font-weight: 500; line-height: 30px; margin-left: -.75rem;"><p id="conclusion">Вывод:</p></div> 
    <div class="row" style="height: 100px; background: white; border-radius: 10px; border: 1px #D9D9D9 solid; margin-bottom: 10px; align-items: center; padding-right: 2%;">
      <textarea id="result" readonly style="width: 100%; height: 100%; background: white; border-radius: 10px; border: none; padding-left: 10px; font-size: 18px; font-family: Gilroy; font-weight: 500;"></textarea>
    </div>
  </div>
</div>

    <div class="row" style="width:40%; margin-right: 10%;margin-left: 0px;">
      <div class="col">
        <span style="color:black; font-size: 20px; font-weight:bold; margin-left: -.75rem;"><p id="viewing_logs">Просмотр логов</p></span>
        <br></br>
        <div class="row">
          <select id="log-select" class="minimal">
            <option value="/var/volatile/log/syslog">SYSLOG</option>
            <option value="/opt/cumanphone/var/log/cumanphone1.log">CUMANPHONELOG</option>
            <option value="/opt/cumanphone/var/log/cumanphone1.log" id="critical_errors">Критические ошибки</option>
          </select>
        </div>
        <br/>
        <div class="row" style="height: 50px; border: none; margin-bottom: 10px; align-items: center;">
          <button id="read-log-button" type="button" class="btn" style="width: 100%; height: 100%; color: white; background: #7BAF21;">Скачать последние записи</button>
        </div>
        <!--<div class="row" style="height: 200px; background: white; border-radius: 10px; border: 1px #D9D9D9 solid; margin-bottom: 10px; align-items: center; padding-right: 2%;">
          <textarea id="log-result" readonly style="width: 100%; height: 100%; background: white; border-radius: 10px; border: none; padding-left: 10px; font-size: 18px; font-family: Gilroy; font-weight: 500;"></textarea>
        </div>-->
      </div>
    </div>
  </div>

  <script type='text/javascript' src="assets/js/translation.js"></script>
  <script type='text/javascript'>
    console.clear();
$(function () {
    $.get("php/language.php", function (data, status) {
        console.log("Data: " + data + "\nStatus: " + status);
        var json = JSON.parse(data);
        
        if (json.language == "kz") 
            $('#kazakh-language').prop("checked", true);
        else if (json.language == "en")
            $('#english-language').prop("checked", true);
        else if (json.language == "ru")
            $('#russian-language').prop("checked", true);
        else if (json.language == "kzlat")
            $('#qazaq-language').prop("checked", true);
        
        window.currentLanguage = json.language;
    });
});
$(function() { 
  $.get("php/status.php", function(data, status){
    console.log("Data:", data, "\nStatus:", status);
    var json = (typeof data === 'string') ? JSON.parse(data) : data;
    if (json.ip) {
      $('#address').val(json.ip);
    }
  });
});
    $(document).ready(function () {
            $.get("php/language.php", function (data) {
                const response = JSON.parse(data);
                const currentLanguage = response.language;
                const currentPage = getPageFromConsole();
                
                loadTranslations(currentLanguage, currentPage, function(translations) {
                    window.translations = translations;
                });
            });
        });

        function loadTranslations(language, pageName, callback) {
            const translationFilePath = `/languages/${pageName}.json`;
            const indexFilePath = '/languages/index.json';

            $.when(
                $.getJSON(translationFilePath),
                $.getJSON(indexFilePath)
            ).done(function (pageTranslations, indexTranslations) {
                const combinedTranslations = Object.assign(
                    {},
                    indexTranslations[0][language] || {},
                    pageTranslations[0][language] || {}
                );
                applyTranslations(combinedTranslations);
                
                if (callback) callback(combinedTranslations);
            }).fail(function () {
                console.error(`Translation files not found: ${translationFilePath} or ${indexFilePath}`);
            });
        }
        
        $('#run-button').on("click", function() {
    var action = $('input[name="action"]:checked').val();
    var address = $('#address').val();
    
    $('#result').html(`${window.translations['in_progress-result'] || 'Выполняется'} ${action}...`);
    $.get('php/diagnosis.php?action=' + action + '&address=' + address + '&language=' + window.currentLanguage, function(data) {
        $('#result').html(data);
    });
});

  $('#read-log-button').on("click", function() {
    var logFile = $('#log-select').val();
    
    var downloadLink = document.createElement('a');
    downloadLink.href = 'php/download.php?logfile=' + encodeURIComponent(logFile);
    downloadLink.download = '';
    
    downloadLink.click();
  });
  
  $('#address').on('keypress', function(event) {
      if (event.which === 13) {
          $('#run-button').click();
      }
  });


  </script>
  </body>
</html>