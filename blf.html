<html>
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
      <script src="assets/js/jquery-3.7.1.js"></script>
      <script src="assets/bootstrap/js/bootstrap.min.js"></script>
      <style>
        
      </style>
   </head>
   <body>
      <div class="container" style="padding-left: 0px;padding-right: 0px;margin: 0px;margin-left: 20px;margin-bottom: 0px;margin-right: 0px;margin-top: 0px;max-width: 100%;">
          <div class="row" style="width:40%; margin-right: 10%;margin-left: 0px;">
              <div class="col">
                
                  <div class="row" style="padding: 15px 0px;"> 
                      <select id="key-select" class="minimal">
                          <option value="1" id="blf-key-1">Клавиша 1</option>
                          <option value="2" id="blf-key-2">Клавиша 2</option>
                          <option value="3" id="blf-key-3">Клавиша 3</option>
                          <option value="4" id="blf-key-4">Клавиша 4</option>
                          <option value="5" id="blf-key-5">Клавиша 5</option>
                          <option value="6" id="blf-key-6">Клавиша 6</option>
                          <option value="7" id="blf-key-7">Клавиша 7</option>
                          <option value="8" id="blf-key-8">Клавиша 8</option>
                          <option value="9" id="blf-key-9">Клавиша 9</option>
                          <option value="10" id="blf-key-10">Клавиша 10</option>
                          <option value="11" id="blf-key-11">Клавиша 11</option>
                          <option value="12" id="blf-key-12">Клавиша 12</option>
                          <option value="13" id="blf-key-13">Клавиша 13</option>
                          <option value="14" id="blf-key-14">Клавиша 14</option>
                          <option value="15" id="blf-key-15">Клавиша 15</option>
                          <option value="16" id="blf-key-16">Клавиша 16</option>
                          <option value="17" id="blf-key-17">Клавиша 17</option>
                          <option value="18" id="blf-key-18">Клавиша 18</option>
                          <option value="19" id="blf-key-19">Клавиша 19</option>
                          <option value="20" id="blf-key-20">Клавиша 20</option>
                          <option value="21" id="blf-key-21">Клавиша 21</option>
                          <option value="22" id="blf-key-22">Клавиша 22</option>
                          <option value="23" id="blf-key-23">Клавиша 23</option>
                          <option value="24" id="blf-key-24">Клавиша 24</option>
                          <option value="25" id="blf-key-25">Клавиша 25</option>
                          <option value="26" id="blf-key-26">Клавиша 26</option>
                          <option value="27" id="blf-key-27">Клавиша 27</option>
                          <option value="28" id="blf-key-28">Клавиша 28</option>
                          <option value="29" id="blf-key-29">Клавиша 29</option>
                          <option value="30" id="blf-key-30">Клавиша 30</option>
                          <option value="31" id="blf-key-31">Клавиша 31</option>
                          <option value="32" id="blf-key-32">Клавиша 32</option>
                          <option value="33" id="blf-key-33">Клавиша 33</option>
                          <option value="34" id="blf-key-34">Клавиша 34</option>
                          <option value="35" id="blf-key-35">Клавиша 35</option>
                          <option value="36" id="blf-key-36">Клавиша 36</option>
                          <option value="37" id="blf-key-37">Клавиша 37</option>
                          <option value="38" id="blf-key-38">Клавиша 38</option>
                          <option value="39" id="blf-key-39">Клавиша 39</option>
                          <option value="40" id="blf-key-40">Клавиша 40</option>
                          <option value="41" id="blf-key-41">Клавиша 41</option>
                          <option value="42" id="blf-key-42">Клавиша 42</option>
                          <option value="43" id="blf-key-43">Клавиша 43</option>
                          <option value="44" id="blf-key-44">Клавиша 44</option>
                          <option value="45" id="blf-key-45">Клавиша 45</option>
                          <option value="46" id="blf-key-46">Клавиша 46</option>
                          <option value="47" id="blf-key-47">Клавиша 47</option>
                          <option value="48" id="blf-key-48">Клавиша 48</option>
                          <option value="49" id="blf-key-49">Клавиша 49</option>
                          <option value="50" id="blf-key-50">Клавиша 50</option>
                          <option value="51" id="blf-key-51">Клавиша 51</option>
                          <option value="52" id="blf-key-52">Клавиша 52</option>
                          <option value="53" id="blf-key-53">Клавиша 53</option>
                          <option value="54" id="blf-key-54">Клавиша 54</option>
                          <option value="55" id="blf-key-55">Клавиша 55</option>
                          <option value="56" id="blf-key-56">Клавиша 56</option>
                          <option value="57" id="blf-key-57">Клавиша 57</option>
                          <option value="58" id="blf-key-58">Клавиша 58</option>
                          <option value="59" id="blf-key-59">Клавиша 59</option>
                          <option value="60" id="blf-key-60">Клавиша 60</option>
                          <option value="61" id="blf-key-61">Клавиша 61</option>
                          <option value="62" id="blf-key-62">Клавиша 62</option>
                          <option value="63" id="blf-key-63">Клавиша 63</option>
                          <option value="64" id="blf-key-64">Клавиша 64</option>
                          <option value="65" id="blf-key-65">Клавиша 65</option>
                          <option value="66" id="blf-key-66">Клавиша 66</option>
                      </select>
                  </div>

                  <div class="row" style="height: 50px; background: white; border-radius: 10px; border: 1px #D9D9D9 solid; margin-bottom: 10px; align-items: center;"> 
                      <div class="col" style="color: #6C6C6C; font-size: 18px; font-family: Gilroy; font-weight: 500; padding-left: 10px;"><p id="enabled-vkl">Включена</p></div>
                      <input id="key-enable" type="checkbox">
                  </div> 
                  <div class="row"><hr style="width:100%;" size="2" color="#9A9A9A" /></div>

                  <div id="type-label" style="color: #6C6C6C; font-size: 20px; font-family: Gilroy; font-weight: 500;  margin-left: -.75rem;"><p id="key_type">Тип клавиши</p></div>
                  <div class="row" style="padding: 5px 0px 20px 0px"> 
                      <select id="type" class="minimal" style="font-size: 20px; font-family: Gilroy; font-weight: 500;">
                          <option value="0" id="BLF-1">BLF</option>
                          <option value="1" id="speed-dial">Быстрый набор</option>
                      </select>
                  </div>

                    <div id="account-label" style="padding: 5px 0px 0px 0px; color: #6C6C6C; font-size: 20px; font-family: Gilroy; font-weight: 500; margin-left: -.75rem;">
                        <p id="account-text">Учетная запись</p>
                    </div>
                    <div id="account-row" class="row" style="border-radius: 10px; border: 1px #D9D9D9 solid;">
                        <select id="account" class="minimal" style="font-size: 20px; font-family: Gilroy; font-weight: 500;">
                            <option value="" disabled selected>Выберите учетную запись</option>
                        </select>
                    </div>

                  <div id="name-label" style="padding: 20px 0px 5px 0px; color: #6C6C6C; font-size: 20px; font-family: Gilroy; font-weight: 500;  margin-left: -.75rem;"><p id="name-text">Имя</p></div>
                  <div id="name-row" class="row" style="height: 50px; background: white; border-radius: 10px; border: 1px #D9D9D9 solid; margin-bottom: 10px; align-items: center;"> 
                      <input id="name" style="width: 100%; height: 100%; background: white; border-radius: 10px; border: none; padding-left: 10px; font-size: 20px; font-family: Gilroy; font-weight: 500;">
                  </div> 
                  <div id="number-label" style="padding: 20px 0px 5px 0px; color: #6C6C6C; font-size: 20px; font-family: Gilroy; font-weight: 500; margin-left: -.75rem;"><p id="number-title">Номер</p></div>
                  <div id="number-row" class="row" style="height: 50px; background: white; border-radius: 10px; border: 1px #D9D9D9 solid; margin-bottom: 10px; align-items: center;"> 
                      <input id="number" style="width: 100%; height: 100%; background: white; border-radius: 10px; border: none; padding-left: 10px; font-size: 20px; font-family: Gilroy; font-weight: 500;">
                  </div>

                  <!--<div class="row" style="height: 50px; border: none; margin-bottom: 10px; align-items: center;"> 
                      <button id="cancel-button" type="button" class="btn" style="width: 48%; height: 100%; margin-right: 2%; color: white; background: #9A9A9A;">Отмена</button>
                      <button id="save-button" type="button" class="btn" style="width: 48%; height: 100%; margin-left: 2%; color: white; background: #7BAF21;">Сохранить</button>   
                  </div>-->
              </div>
          </div>
      </div>
      <nav id="side-button" class="navbar navbar-expand-md navbar-dark fixed-right" style="display: flex; flex-direction: column; justify-content: space-between; align-items: center;">
        <div style="display: flex; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 10px; padding: 20px;">
            <button id="save-button" type="button" class="btn" style="display: flex; align-items: center; color: white; background: #9A9A9A; width: 155px; justify-content: center;">
                Сохранить
            </button>
            <button id="cancel-button" type="button" class="btn" style="display: flex; align-items: center; color: white; background: #9A9A9A; width: 155px; justify-content: center;">
                Сбросить
            </button>
            <button id="restart-button" type="button" class="btn" style="display: flex; align-items: center; color: white; background: #9A9A9A; width: 155px; justify-content: center; border-radius: .35rem;">
                Перезагрузить
            </button>
        </div>
    </nav>
      <script src="assets/js/translation.js"></script>
      <script type='text/javascript'>
        $(document).ready(function () {
            $.ajax({
                url: 'php/blf.php',
                type: 'GET',
                dataType: 'json',
                success: function(response) {
                    console.log('Account Data:', response.accounts);

                    var accountSelect = $('#account');
                    accountSelect.empty();

                    response.accounts.forEach(function(accountObj) {
                        if (accountObj.account && (accountObj.name || accountObj.account)) {
                            var option = document.createElement('option');
                            option.value = accountObj.account;
                            option.textContent = accountObj.name || accountObj.account;
                            accountSelect.append(option);
                        }
                    });
                },
                error: function(xhr, status, error) {
                    console.error('Error fetching data:', error);
                }
            });
        });

        var json;

        function show() {
            $('#type').show();
            $('#type-label').show();
            $('#account').show();
            $('#account-label').show();
            $('#name-row').show();
            $('#name-label').show();
            $('#number-row').show();
            $('#number-label').show();
        }

        function hide() {
            $('#type').hide();
            $('#type-label').hide();
            $('#account').hide();
            $('#account-label').hide();
            $('#name-row').hide();
            $('#name-label').hide();
            $('#number-row').hide();
            $('#number-label').hide();
        }

        function load() {
            $.get("php/blf.php", function(data, status) {
                console.log("Data: " + data);
                console.log("Status: " + status);
                json = JSON.parse(decodeURIComponent(data)); 
                if ("accounts" in json) {
                    $.each(json.accounts, function(i, item) {
                          $('#account').append(new Option(item, item)); 
                    });                     
                }
                if ( "blf" in json ) {
                    key = $('#key-select').val();
                    $('#key-select').val(key).trigger('change');
                }
            });
        }

        $(function() { load() });
        
        $('#key-enable').change(function() {
            if ( $(this).prop('checked') ) 
                show();  
            else 
                hide();
        });

        $('#key-select').change(function() {
            if ( "blf" in json ) {
                var key = "BLF"+ $('#key-select').val();
                console.log(json.blf[key]);   
                if ( key in json.blf ) {
                    $('#key-enable').prop('checked', true);
                    $('#type').val(json.blf[key].type);
                    $('#account').val(json.blf[key].account);
                    $('#name').val(json.blf[key].name);
                    $('#number').val(json.blf[key].number);
                    show();  
                }
                else {
                    $('#key-enable').prop('checked', false);
                    hide();
                } 
            } 
        });

        $('#cancel-button').on( "click", function() {
             $('#content').load("calls.html");  
        });
        $('#restart-button').on( "click", function() { 
                var json = JSON.stringify({ command: 'restart' });
                $.post('php/system.php', json, function(resp) {
                    console.log(resp);
                    var json = JSON.parse(resp);
                    showRestartDialog(json.success); 
                });
            });
        $('#save-button').on( "click", function() {
           var error   = false;
           var account = $('#account').val();
           var number  = $('#number').val();
           var name = $('#name').val();

           if ( !account || account.length == 0 ) {
               $('#account-row').css({"border" : "1px red solid"});
               error = true;  
           }
           else
               $('#account-row').css({"border" : "1px #D9D9D9 solid"});


           if ( number.length == 0 ) {
               $('#number-row').css({"border" : "1px red solid"});
               error = true;  
           }
           else
               $('#number-row').css({"border" : "1px #D9D9D9 solid"});

           if ( error ) {
               showNotCompleteDialog();
               return; 
           }

           var data = {command   : 'save',
                       key       : $('#key-select').val(),
                       enable    : Number($('#key-enable').prop('checked')),
                       type      : $('#type').val(),
                       account   : $('#account').val(),
                       name      : $('#name').val(),
                       number    : $('#number').val()};
           var json = JSON.stringify(data);
           console.log(json);
           $.post('php/blf.php', json, function(resp){
                 console.log(resp);
                 var json = JSON.parse(resp);
                 showDialog(json.success, true); 
                 load();  
           });
        });
     </script>
  </body>
</html>
